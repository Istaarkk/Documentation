### ğŸ” **1. Commande `dt` : Display Type**

La commande `dt` permet dâ€™**afficher la structure dâ€™une variable ou dâ€™un type de donnÃ©es** connu, avec ses **champs internes et leurs offsets** mÃ©moire.

#### ğŸ“Œ Syntaxe :

```rust
dt [Module]![Structure] [adresse (optionnelle)]
```


#### ğŸ§ª Exemples :

```rust
dt ntdll!_TEB; affiche la structure TEB 
dt ntdll!_TEB 0x7ffde000 ; affiche les valeurs de la TEB Ã  l'adresse donnÃ©e

```

#### âœ… Ce que WinDbg retourne :

- Nom des champs de la structure
    
- Offset mÃ©moire de chaque champ
    
- Type (Uint4B, Ptr64, Char, etc.)
    
- Taille (via tableaux ou types dÃ©rivÃ©s)
    

---

### ğŸ§  **2. Pourquoi câ€™est utile**

- Pour **inspecter dynamiquement** les structures du noyau et de lâ€™espace utilisateur
    
- Identifier des **pointeurs critiques** : `PEB`, `TEB`, `ClientId`, etc.
    
- Lire la mÃ©moire sans reverse engineering manuel
    
- DÃ©boguer plus vite : tu nâ€™as pas besoin de connaÃ®tre manuellement la structure
    

#### ğŸ¯ Cas dâ€™usage typique :

- Lire la structure `_TEB` dâ€™un thread pour accÃ©der Ã  :
    
    - `ClientId` (TID / PID)
        
    - `ProcessEnvironmentBlock`
        
    - `LastErrorValue`
        
    - `StackBase`, `StackLimit`, etc.
        

---

### ğŸ§© **3. Exemple commentÃ© : `_TEB`**
```rust
`0:000> dt ntdll!_TEB 
+0x040 ClientId         : _CLIENT_ID     ; contient UniqueProcess & UniqueThread 
+0x060 ProcessEnvironmentBlock : Ptr64 _PEB 
+0x07f0 GdiClientPID    : Uint4B 
+0x1250 LastStatusValue  : Uint4B`
```

> Ces champs peuvent Ãªtre directement utilisÃ©s pour identifier des Ã©lÃ©ments comme :
> 
> - lâ€™environnement du processus (`PEB`)
>     
> - lâ€™ID du thread
>     
> - lâ€™Ã©tat du dernier appel systÃ¨me
>     

---

### ğŸ§® **4. Utilisation dâ€™une adresse**

Tu peux inspecter la structure Ã  une adresse spÃ©cifique en la passant comme 2e argument:
```rust
0:000> dt ntdll!_TEB 0x7ffde000
```

Cela va **afficher les valeurs** courantes des champs Ã  cette adresse (utile en post-mortem).

---

### ğŸ› ï¸ **5. Astuce : Trouver lâ€™adresse du TEB**

#### Depuis WinDbg :

```rust
r @$teb       ; pseudo-registre pour accÃ©der Ã  l'adresse du TEB
```


---

## ğŸ§® **6. Pseudo-Registres dans WinDbg**

WinDbg propose des **pseudo-registres** pour simplifier lâ€™accÃ¨s Ã  certaines structures internes.

|Pseudo-Registre|Description|
|---|---|
|`@$teb`|Adresse du TEB actuel|
|`@$peb`|Adresse du PEB actuel|
|`@$ip`|Valeur du EIP/RIP|
|`@$sp`|ESP ou RSP|
|`@eip`, `@esp`|Registres classiques (x86)|
|`@rcx`, `@rdx`|Registres x64|

> Ces pseudo-registres peuvent Ãªtre utilisÃ©s dans :
> 
> - Les expressions conditionnelles
>     
> - Les calculs (`?`, `.if`, `dd @$peb+0x10`)
>     
> - Les affichages (`dt`, `dq`, `dd`...)
>     

---

### ğŸ“Œ Exemple :

Afficher les modules chargÃ©s via le PEB :
```rust
dt _PEB @$peb
```


Inspecter la base dâ€™image de lâ€™exÃ©cutable :
```rust
dd poi(@$peb+0x10)  ; ImageBaseAddress
```

